# ูพุฑูฺู ุดุจูโุณุงุฒ ู ุชุณุชุฑ ููฺฉ ุงุฑุชุจุงุท MAVLink

ุงู ูพุฑูฺู ฺฉ ูุฌููุนู ุงุจุฒุงุฑ ูุฏุฑุชููุฏ ุจุฑุง ุชุณุชุ ุดุจูโุณุงุฒ ู ุชุญูู ุนููฺฉุฑุฏ ููฺฉโูุง ุงุฑุชุจุงุท ุณุฑุงูุ ุจู ูฺู ุจุฑุง ฺฉุงุฑุจุฑุฏูุง ูพููพุงุฏ ู ูพุฑูุชฺฉู **MAVLink** ุงุณุช. ุจุง ุงุณุชูุงุฏู ุงุฒ ุงู ุงุจุฒุงุฑูุงุ ูโุชูุงู ูุนุงุฑูุง ฺฉูุฏ ูุงููุฏ **Round-Trip Time (RTT)**ุ **ูพููุง ุจุงูุฏ** ู **Packet Loss** ุฑุง ุชุญุช ุดุฑุงุท ุชุฑุงูฺฉ ฺฉูุชุฑูโุดุฏู ู ูุงูุนโฺฏุฑุงุงูู ุงูุฏุงุฒูโฺฏุฑ ฺฉุฑุฏ.

ุงู ูพุฑูฺู ุจู ุฎุตูุต ุจุฑุง ุงุฑุฒุงุจ ุนููฺฉุฑุฏ ููุฏูโูุง ุฑุงุฏู (ูุงููุฏ ููุฏูโูุง P900) ุฏุฑ ุณูุงุฑููุง ูุฎุชูู ูพุฑูุงุฒ ุทุฑุงุญ ุดุฏู ุงุณุช.

**ุชุงุฑุฎ ุงูุฑูุฒ:** ฑดฐด/ฐ7/ฑน

---

## โญ๏ธ ูุงุจูุชโูุง ฺฉูุฏ

- **ุชููุฏ ุชุฑุงูฺฉ ูพุณโุฒููู (Background Traffic):** ุดุจูโุณุงุฒ ุชุฑุงูฺฉ MAVLink ุจุง ูุฑุฎ ุจุช (Bandwidth) ูุดุฎุต ุจุฑุง ุงุฌุงุฏ ุจุงุฑ ุฑู ููฺฉ ุงุฑุชุจุงุท.
- **ุชุฒุฑู ุจุณุชูโูุง Probe:** ุงุฑุณุงู ุจุณุชูโูุง ูฺู (Probe) ุจุง ุงูุฏุงุฒูโูุง ูุฎุชูู ุจุฑุง ุงูุฏุงุฒูโฺฏุฑ ุฏูู RTT ู ุจุฑุฑุณ ุชุฃุซุฑ ุญุฌู ุจุณุชู ุจุฑ ุชุฃุฎุฑ.
- **ูพุฑููุงู ุชุฑุงูฺฉ ูุงูุนโฺฏุฑุงุงูู:** ุงุณุชูุงุฏู ุงุฒ ฺฉ ูพุฑููุงู ูพุดโูุฑุถ (`MAVLinkProfile`) ฺฉู ุจุฑ ุงุณุงุณ ุชุญูู ุชุฑุงูฺฉ ูุงูุน MAVLink ุณุงุฎุชู ุดุฏู ู ุชูุฒุน ุงูุฏุงุฒูโ ุจุณุชูโูุง ู ูุฑฺฉุงูุณ ูพุงูโูุง ุฑุง ูุฏู ูโฺฉูุฏ.
- **ุดุจูโุณุงุฒ ูุจุชู ุจุฑ MAVSDK:** ฺฉ ุดุจูโุณุงุฒ ุณุทุญ ุจุงูุง ฺฉู ูโุชูุงูุฏ ุชุฑุงูฺฉ ุชููุชุฑ ูุงูุน ฺฉ ูพููพุงุฏ (ูุงููุฏ ูููุนุชุ ูุถุนุช ุจุงุชุฑ ู ...) ุฑุง ุจุง ุงุณุชูุงุฏู ุงุฒ ฺฉุชุงุจุฎุงูู MAVSDK ุชููุฏ ฺฉูุฏ.
- **ูุงฺููุงุฑ ู ูุงุจู ุชูุณุนู:** ุณุงุฎุชุงุฑ ฺฉุฏ ุจู ุตูุฑุช ูุงฺููุงุฑ ุทุฑุงุญ ุดุฏู ุชุง ุงูฺฉุงู ุงูุฒูุฏู ุชุณุชโูุง ุฌุฏุฏ ุง ูพุฑููุงูโูุง ุชุฑุงูฺฉ ูุชูุงูุช ุจู ุณุงุฏฺฏ ูุฑุงูู ุจุงุดุฏ.
- **ุชุญูู ูุชุงุฌ:** ุงุจุฒุงุฑูุง ุจุฑุง ุชุญูู ุขูุงุฑ ูุชุงุฌ ุชุณุชโูุงุ ูุงููุฏ ูุญุงุณุจู ูุงูฺฏูุ ูุงูู ู ุตุฏฺฉ 95 ุจุฑุง RTT ุจุฑ ุงุณุงุณ ุงูุฏุงุฒูโูุง ูุฎุชูู ุจุณุชูโูุง.

---

## ๐๏ธ ูุนูุงุฑ ู ุณุงุฎุชุงุฑ ูพุฑูฺู

ูพุฑูฺู ุงุฒ ฺูุฏู ูุงฺูู ุงุตู ุชุดฺฉู ุดุฏู ฺฉู ูุฑ ฺฉุฏุงู ูุธูู ูุดุฎุต ุฑุง ุจุฑ ุนูุฏู ุฏุงุฑูุฏ:
```
project/
โ
โโโ core/                   # ูุงฺููโูุง ุงุตู ู ูุณุชู ูพุฑูฺู
โ   โโโ mavlink_profile.py      # ูุฏุฑุช ูพุฑููุงู ุชุฑุงูฺฉ MAVLink (ุงูุฏุงุฒู ู ูุฑฺฉุงูุณ ุจุณุชูโูุง)
โ   โโโ packet_generator.py     # ุชููุฏ ุจุณุชูโูุง Probe ู ุชุฑุงูฺฉ MAVLink ุณุงุฎุชฺฏ
โ   โโโ traffic_simulator.py    # ุชููุฏ ุชุฑุงูฺฉ ูพุณโุฒููู ุจุง ูพููุง ุจุงูุฏ ุซุงุจุช
โ   โโโ probe_injector.py       # ุชุฒุฑู ุจุณุชูโูุง Probe ู ุงูุฏุงุฒูโฺฏุฑ RTT
โ   โโโ mavsdk_simulator.py     # ุดุจูโุณุงุฒ ุชุฑุงูฺฉ ูุงูุน ุจุง MAVSDK
โ   โโโ p900_tester.py          # ุงุณฺฉุฑูพุช ุงุตู ุจุฑุง ุงุฌุฑุง ุชุณุชโูุง ุชุฑฺฉุจ
โ
โโโ tests/                  # ุชุณุชโูุง ุนููุงุช ู ุณูุงุฑููุง ุงุฑุฒุงุจ
โ   โโโ test_mavlink_rtt.py     # ุชุณุช ุงูุฏุงุฒูโฺฏุฑ RTT ุชุญุช ุชุฑุงูฺฉ ูพุณโุฒููู
โ   โโโ ...
โ
โโโ analysis/               # ุงุณฺฉุฑูพุชโูุง ุชุญูู ู ูุตูุฑุณุงุฒ ูุชุงุฌ
โ   โโโ inspect_json.py
โ   โโโ plot_results.py
โ
โโโ utils/                  # ุงุจุฒุงุฑูุง ฺฉูฺฉ (ูุงฺฏุฑุ ฺฉุงููฺฏ ู ...)
โโโ config.py
โโโ logger.py

### ูุญูู ุนููฺฉุฑุฏ ฺฉู

ฺฉ ุณูุงุฑู ุชุณุช ูุนููู ุจู ุงู ุตูุฑุช ุนูู ูโฺฉูุฏ:

1.  **ุจุงุฑฺฏุฐุงุฑ ูพุฑููุงู (`MAVLinkProfile`):** ุงุจุชุฏุงุ ฺฉ ูพุฑููุงู ุชุฑุงูฺฉ MAVLink ุจุงุฑฺฏุฐุงุฑ ูโุดูุฏ. ุงู ูพุฑููุงู ูุดุฎุต ูโฺฉูุฏ ฺฉู ุจุณุชูโูุง ุชุฑุงูฺฉ ุจุงุฏ ฺู ุชูุฒุน ุงูุฏุงุฒูโุง ุฏุงุดุชู ุจุงุดูุฏ.
2.  **ุงุฌุงุฏ ุชุฑุงูฺฉ ูพุณโุฒููู (`TrafficSimulator`):** ฺฉ ุดุจูโุณุงุฒุ ุชุฑุงูฺฉ ูพุณโุฒูููโุง ุฑุง ุจุฑ ุงุณุงุณ ูพุฑููุงู MAVLink ุฑู ูพูุฑุช ุณุฑุงู (ูุซูุงู ููุฏู ุฑุงุฏู) ุจุง ูพููุง ุจุงูุฏ ูุดุฎุต (ูุซูุงู 56 kbps) ุดุฑูุน ุจู ุงุฑุณุงู ูโฺฉูุฏ. ุงู ฺฉุงุฑ ุจุงุนุซ ุงุดุจุงุน ุดุฏู ููฺฉ ู ุดุจูโุณุงุฒ ฺฉ ูุญุท ูุงูุน ูโุดูุฏ.
3.  **ุชุฒุฑู ุจุณุชูโูุง Probe (`ProbeInjector`):** ููุฒูุงู ุจุง ุชุฑุงูฺฉ ูพุณโุฒูููุ ฺฉ ูุงฺูู ุฏฺฏุฑ ุจุณุชูโูุง ูฺูโุง ุจู ูุงู "Probe" ุฑุง ุจู ููฺฉ ุชุฒุฑู ูโฺฉูุฏ. ุงู ุจุณุชูโูุง ุงูุฏุงุฒูโูุง ูุดุฎุต ู ููุงูุฏูโุง ุฏุงุฑูุฏ (ูุซูุงู 13, 30, 40, ... , 82 ุจุงุช).
4.  **ุงูุฏุงุฒูโฺฏุฑ RTT:** ุณุณุชู ููุชุธุฑ ุจุงุฒฺฏุดุช (Echo) ูุฑ ุจุณุชู Probe ูโูุงูุฏ ู ุฒูุงู ุฑูุช ู ุจุฑฺฏุดุช (RTT) ุฑุง ุจุฑุง ุขู ูุญุงุณุจู ูโฺฉูุฏ.
5.  **ุฌูุนโุขูุฑ ู ุชุญูู ูุชุงุฌ:** ูพุณ ุงุฒ ุงุชูุงู ุชุณุชุ ุฏุงุฏูโูุง RTT ุจุฑุง ูุฑ ุงูุฏุงุฒู ุจุณุชู ุฌูุนโุขูุฑ ุดุฏู ู ุขูุงุฑูุง ูุงููุฏ ูุงูฺฏูุ ูุงููุ ุงูุญุฑุงู ูุนุงุฑ ู ุตุฏฺฉโูุง ูุญุงุณุจู ูโุดูุฏ. ุงู ูุชุงุฌ ุฏุฑ ฺฉ ูุงู JSON ุฐุฎุฑู ูโุดููุฏ ุชุง ุจุนุฏุงู ุชูุณุท ุงุณฺฉุฑูพุชโูุง `analysis` ุชุญูู ู ูุตูุฑุณุงุฒ ุดููุฏ.

---

## โ๏ธ ูุนุฑู ูุงฺููโูุง ุงุตู

#### `core/mavlink_profile.py`
ุงู ูุงฺูู ููุจ ุดุจูโุณุงุฒ ูุงูุนโฺฏุฑุงุงูู ุงุณุช.
-   ฺฉ ูพุฑููุงู ูพุดโูุฑุถ ุงุฒ ุชุฑุงูฺฉ MAVLink ุฑุง ุจุฑ ุงุณุงุณ ุฏุงุฏูโูุง ูุงูุน ุชุนุฑู ูโฺฉูุฏ.
-   ุดุงูู ุชูุฒุน ุขูุงุฑ ุงูุฏุงุฒูโูุง ุจุณุชูโูุง (ูุซูุงู 29% ุจุณุชูโูุง "ุจุณุงุฑ ฺฉูฺฺฉ" ูุณุชูุฏ).
-   ุดุงูู ูุณุช ุงุฒ ูพุงูโูุง ุฑุงุฌ MAVLink ู ูุฑฺฉุงูุณ ุงุฑุณุงู ุขูโูุง (ูุงููุฏ `ATTITUDE` ุจุง ูุฑฺฉุงูุณ 30Hz).
-   ูุชุฏ ุจุฑุง ุชููุฏ "ุงูุฏุงุฒูโูุง ููุงูุฏู" (`representative_sizes`) ูุฑุงูู ูโฺฉูุฏ ฺฉู ุฏุฑ ุชุณุชโูุง RTT ุงุณุชูุงุฏู ูโุดููุฏ.

#### `core/packet_generator.py`
ูุณุฆูู ุณุงุฎุชู ุจุงุชโูุง ุฎุงู ุจุณุชูโูุงุณุช.
-   `generate_probe_packet()`: ฺฉ ุจุณุชู Probe ุจุง ุณุงุฎุชุงุฑ ุณูุงุฑุด `[Type][Size][ID][Payload][Checksum]` ุชููุฏ ูโฺฉูุฏ. ุงู ุจุณุชูโูุง MAVLink ูุณุชูุฏ ู ููุท ุจุฑุง ุงูุฏุงุฒูโฺฏุฑ RTT ุจู ฺฉุงุฑ ูโุฑููุฏ.
-   `generate_mavlink_traffic()`: ุจุณุชูโูุง ุจุง ุณุงุฎุชุงุฑ ุดุจู ุจู MAVLink v1 ุจุฑุง ุงุณุชูุงุฏู ุฏุฑ ุชุฑุงูฺฉ ูพุณโุฒููู ุชููุฏ ูโฺฉูุฏ.
-   ูโุชูุงูุฏ ุจุณุชูโูุง ุฑุง ุจุฑ ุงุณุงุณ ุญุงูุชโูุง ูุฎุชูู (`representative`, `realistic`, `random`) ุชููุฏ ฺฉูุฏ.

#### `core/traffic_simulator.py`
ุงู ูุงฺูู ฺฉ ุชููุฏฺฉููุฏู ุชุฑุงูฺฉ ุณุงุฏู ู ฺฉุงุฑุขูุฏ ุงุณุช.
-   ฺฉ ูพูุฑุช ุณุฑุงู ุฑุง ุจู ุนููุงู ูุฑูุฏ ูโฺฏุฑุฏ.
-   ฺฉ ุฌุฑุงู ุซุงุจุช ุงุฒ ุฏุงุฏูโูุง ุฑุง ุจุง ูุฑุฎ ุจุช (ูพููุง ุจุงูุฏ) ูุดุฎุต ุดุฏู ุฑู ูพูุฑุช ุงุฑุณุงู ูโฺฉูุฏ.
-   ุฏุฑ ฺฉ `thread` ุฌุฏุงฺฏุงูู ุงุฌุฑุง ูโุดูุฏ ุชุง ุจุง ุณุงุฑ ุจุฎุดโูุง ุจุฑูุงูู ุชุฏุงุฎู ูุฏุงุดุชู ุจุงุดุฏ.
-   ุฏูุช ุจุงูุง ุฏุฑ ุฑุณุฏู ุจู ูพููุง ุจุงูุฏ ูุฏู ุฏุงุฑุฏ.

#### `core/probe_injector.py`
ูุธูู ุงู ูุงฺููุ ุงุฌุฑุง ููุทู ุงุตู ุชุณุช RTT ุงุณุช.
-   ุงุฒ `PacketGenerator` ุจุฑุง ุณุงุฎุช ุจุณุชูโูุง Probe ุจุง ุงูุฏุงุฒูโูุง ูุฎุชูู ุงุณุชูุงุฏู ูโฺฉูุฏ.
-   ุจุณุชูโูุง ุฑุง ุงุฑุณุงู ฺฉุฑุฏูุ ุฒูุงู ุฑุง ุซุจุช ูโฺฉูุฏ ู ููุชุธุฑ ูพุงุณุฎ Echo ูโูุงูุฏ.
-   RTTุ Packet Loss ู ุณุงุฑ ูุนุงุฑูุง ุฑุง ูุญุงุณุจู ฺฉุฑุฏู ู ูุชุงุฌ ุฑุง ุจุฑุง ุชุญูู ุฐุฎุฑู ูโฺฉูุฏ.

#### `core/mavsdk_simulator.py`
ฺฉ ุฑูุด ุฌุงฺฏุฒู ู ุณุทุญ ุจุงูุงุชุฑ ุจุฑุง ุชููุฏ ุชุฑุงูฺฉ.
-   ุจู ุฌุง ุชููุฏ ุจุณุชูโูุง ุณุงุฎุชฺฏุ ุงุฒ ฺฉุชุงุจุฎุงูู `MAVSDK` ุจุฑุง ุงุชุตุงู ุจู ฺฉ ุดุจูโุณุงุฒ (ูุงููุฏ PX4 SITL) ุง ฺฉ ูพููพุงุฏ ูุงูุน ุงุณุชูุงุฏู ูโฺฉูุฏ.
-   ุฌุฑุงูโูุง ุชููุชุฑ ูุงูุน (ูุงููุฏ `Attitude`, `Position`, `GPS`) ุฑุง ุจุง ูุฑฺฉุงูุณโูุง ูุดุฎุต ูุนุงู ูโฺฉูุฏ.
-   ุชุฑุงูฺฉ ุชููุฏ ุดุฏู ุจุณุงุฑ ุจู ุณูุงุฑู ูพุฑูุงุฒ ูุงูุน ูุฒุฏฺฉ ุงุณุช.

---

## ๐ ุฑุงูููุง ุงุณุชูุงุฏู ู ุงุฌุฑุง

ุจุฑุง ุงุฌุฑุง ฺฉ ุชุณุช ุงุณุชุงูุฏุงุฑุฏ RTTุ ูโุชูุงูุฏ ุงุฒ ุงุณฺฉุฑูพุช ุงุตู `p900_tester.py` ุง ฺฉ ุงุฒ ุงุณฺฉุฑูพุชโูุง ููุฌูุฏ ุฏุฑ ูพูุดู `tests/` ุงุณุชูุงุฏู ฺฉูุฏ.

### ูุซุงู: ุงุฌุฑุง ุชุณุช RTT

ุงุณฺฉุฑูพุช `tests/test_mavlink_rtt.py` ฺฉ ูุซุงู ุฎูุจ ุจุฑุง ุงู ฺฉุงุฑ ุงุณุช. ูุฑุงุญู ฺฉู ุงุฌุฑุง ุขู ุจู ุดฺฉู ุฒุฑ ุงุณุช:

1.  **ุงุชุตุงู ูพูุฑุชโูุง:** ุดูุง ุจู ุฏู ูพูุฑุช ุณุฑุงู ูุงุฒ ุฏุงุฑุฏ ฺฉู ุจู ูู ูุชุตู ูุณุชูุฏ (ูุซูุงู ุงุฒ ุทุฑู ุฏู ููุฏู ุฑุงุฏู ุง ฺฉ ฺฉุงุจู Null-Modem). ฺฉ ุจู ุนููุงู `sender` (ูุฑุณุชูุฏู) ู ุฏฺฏุฑ ุจู ุนููุงู `echo` (ูพุงุณุฎโุฏููุฏู) ุนูู ูโฺฉูุฏ.

2.  **ุงุฌุฑุง ุงุณฺฉุฑูพุช `echo`:**
ุฏุฑ ฺฉ ุชุฑููุงูุ ุงุณฺฉุฑูพุช `echo.py` ุฑุง ุฑู ูพูุฑุช ูพุงุณุฎโุฏููุฏู ุงุฌุฑุง ฺฉูุฏ:
```bash
    python analysis/echo.py /dev/ttyUSB1
```
ุงู ุงุณฺฉุฑูพุช ุจู ุณุงุฏฺฏ ูุฑ ุฏุงุฏูโุง ฺฉู ุฏุฑุงูุช ฺฉูุฏ ุฑุง ุจุงุฒูโฺฏุฑุฏุงูุฏ.

3.  **ุงุฌุฑุง ุงุณฺฉุฑูพุช ุชุณุช:**
ุฏุฑ ุชุฑููุงู ุฏฺฏุฑุ ุงุณฺฉุฑูพุช ุชุณุช ุงุตู ุฑุง ุจุง ูุดุฎุต ฺฉุฑุฏู ูพูุฑุช ูุฑุณุชูุฏูุ ูพููุง ุจุงูุฏ ุชุฑุงูฺฉ ูพุณโุฒููู ู ูุงู ูุงู ุฎุฑูุฌ ุงุฌุฑุง ฺฉูุฏ:
```bash
    python tests/test_mavlink_rtt.py \
      --port /dev/ttyUSB0 \
      --baudrate 57600 \
      --bandwidth 4000 \
      --output results/rtt_test_4k_bps.json
```
-   `--port`: ูพูุฑุช ุณุฑุงู ฺฉู ููุฏู ูุฑุณุชูุฏู ุจู ุขู ูุชุตู ุงุณุช.
-   `--bandwidth`: ูพููุง ุจุงูุฏ ุชุฑุงูฺฉ ูพุณโุฒููู ุจู ุจุงุช ุจุฑ ุซุงูู (B/s).
-   `--output`: ูุงู JSON ุจุฑุง ุฐุฎุฑู ูุชุงุฌ.

4.  **ุชุญูู ูุชุงุฌ:**
ูพุณ ุงุฒ ุงุชูุงู ุชุณุชุ ูโุชูุงูุฏ ุงุฒ ุงุณฺฉุฑูพุช `plot_results.py` ุจุฑุง ูุตูุฑุณุงุฒ ูุชุงุฌ ุงุณุชูุงุฏู ฺฉูุฏ:
```bash
    python analysis/plot_results.py results/rtt_test_4k_bps.json
```
ุงู ุงุณฺฉุฑูพุช ูููุฏุงุฑูุง ูุงููุฏ "RTT ุฏุฑ ุจุฑุงุจุฑ ุงูุฏุงุฒู ุจุณุชู" ุฑุง ุชููุฏ ูโฺฉูุฏ.

---

### ุงุฌุฑุง ุดุจูโุณุงุฒ MAVSDK

ุจุฑุง ุชุณุช ุชุฑุงูฺฉ ูุงูุนโฺฏุฑุงุงูู ุจุฏูู ูุงุฒ ุจู ุณุฎุชโุงูุฒุงุฑ ูุฒฺฉุ ูโุชูุงูุฏ ุงุฒ `mavsdk_simulator.py` ุงุณุชูุงุฏู ฺฉูุฏ. ุงู ุงุณฺฉุฑูพุช ุจู ฺฉ ุดุจูโุณุงุฒ ูพุฑูุงุฒ (SITL) ูุชุตู ุดุฏู ู ุชุฑุงูฺฉ ุชููุชุฑ ุชููุฏ ูโฺฉูุฏ.

bash
# ูุซุงู ุจุฑุง ุงุชุตุงู ุจู ุดุจูโุณุงุฒ ุฏุฑ ุญุงู ุงุฌุฑุง
python core/mavsdk_simulator.py

ุงู ุงุจุฒุงุฑ ุจู ุดูุง ฺฉูฺฉ ูโฺฉูุฏ ุชุง ุฏุฑฺฉ ุจูุชุฑ ุงุฒ ุญุฌู ุชุฑุงูฺฉ ู ูพููุง ุจุงูุฏ ููุฑุฏ ูุงุฒ ุฏุฑ ุณูุงุฑููุง ูุฎุชูู ูพุฑูุงุฒ ุจู ุฏุณุช ุขูุฑุฏ.

ุงูุฏูุงุฑู ุงู ูุณุชูุฏุงุช ุจู ุดูุง ุฏุฑ ุฏุฑฺฉ ุจูุชุฑ ูพุฑูฺู ู ุชูุณุนู ุขูุฏู ุขู ฺฉูฺฉ ฺฉูุฏ!

`